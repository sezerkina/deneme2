<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ankara’nın Sinematik Kartografyası</title>
<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<style>
html,body{height:100%;margin:0;font-family:-apple-system, BlinkMacSystemFont,'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f7f9fb;overflow:hidden;}
#sidebar{position:absolute;left:0;top:0;width:340px;height:100%;background:#fff;border-right:1px solid #e6eef6;box-shadow:2px 0 6px rgba(0,0,0,0.06);padding:18px;box-sizing:border-box;overflow:auto;transition:transform .35s ease;z-index:1200;}
#sidebar.closed{transform:translateX(-100%);}
#map{position:absolute;left:0;top:0;right:0;bottom:0;z-index:1;}
</style>
</head>
<body>
<aside id="sidebar">
<h1>Ankara’nın Sinematik Kartografyası</h1>
<div id="tab-menu" style="display:flex;gap:8px;margin-bottom:12px;">
  <button class="tab-btn active" data-tab="filmler" style="flex:1;padding:6px 4px;border:1px solid #ccc;border-radius:6px;background:#e8ecf3;font-weight:600;cursor:pointer;">Filmler ve Mekânlar</button>
  <button class="tab-btn" data-tab="yogunluk" style="flex:1;padding:6px 4px;border:1px solid #ccc;border-radius:6px;background:#fff;cursor:pointer;">Mekânsal Dağılım ve Yoğunluk</button>
</div>
</aside>
<div id="map"></div>
<script>
const map=L.map('map',{zoomControl:true}).setView([39.93,32.85],11);
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{maxZoom:22,attribution:'&copy; OpenStreetMap contributors, &copy; Carto'}).addTo(map);
const allLayers=L.layerGroup().addTo(map);

function loadHeatmap(){
  fetch('heatmap_points.geojson').then(r=>r.json()).then(data=>{
    allLayers.clearLayers();
    const heatPoints=[];
    data.features.forEach(f=>{
      if(!f.geometry||f.geometry.type!=='Point')return;
      const [lon,lat]=f.geometry.coordinates;
      heatPoints.push([lat,lon,1.0]);
    });
    const heat=L.heatLayer(heatPoints,{
      radius:27,
      blur:13,
      max:0.1,
      gradient:{
        0.0:'rgba(0,0,0,0)',
        0.2:'rgba(140,0,0,0.6)',
        0.4:'rgba(255,69,0,0.7)',
        0.6:'rgba(255,140,0,0.8)',
        0.8:'rgba(255,200,0,0.9)',
        1.0:'rgba(255,255,0,1.0)'
      }
    }).addTo(allLayers);
    const latlngs=heatPoints.map(p=>[p[0],p[1]]);
    const bounds=L.latLngBounds(latlngs);
    if(bounds.isValid())map.fitBounds(bounds.pad(0.08));
  });
}

// Tab switching
const buttons=document.querySelectorAll('.tab-btn');
buttons.forEach(btn=>{
  btn.addEventListener('click',()=>{
    buttons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    if(btn.dataset.tab==='yogunluk'){
      loadHeatmap();
    } else {
      allLayers.clearLayers();
    }
  });
});
</script>
</body>
</html>